<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>django model 和 查询 知识点 - Michelia</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Michelia" />
  <meta name="description" content="多表关联查询 - 计算机的世界主要就是操作数据，所以orm一定要使用好 学习使用Django，重要的一块就orm。 初次使用感觉总体还是很好用的。主要是Django的文档比较全。 只要多看看文档，一切问题还是都能解决的。 对于初学者而言，其中最难的就是多表关联查询，以及列表或group返回关联查询的结果。 差不多用了一天的时间，粗略看了Django关于model的文档，真是大而全呀。 " />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.26" />


<link rel="canonical" href="http://michelia.github.io/post/django/django-model/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.min.css?v=2.5.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">

<meta property="og:title" content="django model 和 查询 知识点" />
<meta property="og:description" content="多表关联查询 - 计算机的世界主要就是操作数据，所以orm一定要使用好
学习使用Django，重要的一块就orm。
初次使用感觉总体还是很好用的。主要是Django的文档比较全。
只要多看看文档，一切问题还是都能解决的。
对于初学者而言，其中最难的就是多表关联查询，以及列表或group返回关联查询的结果。
差不多用了一天的时间，粗略看了Django关于model的文档，真是大而全呀。
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://michelia.github.io/post/django/django-model/" />



<meta property="article:published_time" content="2015-09-01T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2015-09-01T00:00:00&#43;00:00"/>











<meta itemprop="name" content="django model 和 查询 知识点">
<meta itemprop="description" content="多表关联查询 - 计算机的世界主要就是操作数据，所以orm一定要使用好
学习使用Django，重要的一块就orm。
初次使用感觉总体还是很好用的。主要是Django的文档比较全。
只要多看看文档，一切问题还是都能解决的。
对于初学者而言，其中最难的就是多表关联查询，以及列表或group返回关联查询的结果。
差不多用了一天的时间，粗略看了Django关于model的文档，真是大而全呀。
">


<meta itemprop="dateModified" content="2015-09-01T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="870">



<meta itemprop="keywords" content="django,orm," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="django model 和 查询 知识点"/>
<meta name="twitter:description" content="多表关联查询 - 计算机的世界主要就是操作数据，所以orm一定要使用好
学习使用Django，重要的一块就orm。
初次使用感觉总体还是很好用的。主要是Django的文档比较全。
只要多看看文档，一切问题还是都能解决的。
对于初学者而言，其中最难的就是多表关联查询，以及列表或group返回关联查询的结果。
差不多用了一天的时间，粗略看了Django关于model的文档，真是大而全呀。
"/>

<!--[if lt IE 9]>
  <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Michelia</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Michelia</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">django model 和 查询 知识点</h1>

      <div class="post-meta">
        <span class="post-time">
          2015-09-01
        </span>
        <div class="post-category">
            <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
          </div>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
      <nav id="TableOfContents">
<ul>
<li><a href="#在queryset使用关联表的字段名字规则是">在QuerySet使用关联表的字段名字规则是</a></li>
<li><a href="#查到后取值得字段名字">查到后取值得字段名字</a>
<ul>
<li>
<ul>
<li><a href="#关于一对多或多对多的关系链-查找的时候一定要理解-spanning-multi-valued-relationships-这段的意思-被给自己留下查询的隐患">&gt;：关于一对多或多对多的关系链，查找的时候一定要理解“Spanning multi-valued relationships”这段的意思，被给自己留下查询的隐患。</a></li>
<li><a href="#mysql的distinct使用">&gt; mysql的distinct使用</a></li>
<li><a href="#在model中写方法-而且还能链式使用">&gt; 在model中写方法，而且还能链式使用</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>多表关联查询 - 计算机的世界主要就是操作数据，所以orm一定要使用好
学习使用Django，重要的一块就orm。
初次使用感觉总体还是很好用的。主要是Django的文档比较全。
只要多看看文档，一切问题还是都能解决的。
对于初学者而言，其中最难的就是多表关联查询，以及列表或group返回关联查询的结果。
差不多用了一天的时间，粗略看了Django关于model的文档，真是大而全呀。
</p>

<h1 id="在queryset使用关联表的字段名字规则是">在QuerySet使用关联表的字段名字规则是</h1>

<p>Django offers a powerful and intuitive way to “follow” relationships in lookups, taking care of the SQL JOINs for you automatically, behind the scenes. To span a relationship, just use the field name of related fields across models, separated by double underscores, until you get to the field you want.
最重要的是这种 <code>__</code> 可以无限制的用很多个，这取决于你的数据库结构。
查询时，一对多的关系，直接使用相应model名的小写加<code>__</code>就可以查询相应的字段了，不需要加<code>_set</code></p>

<h1 id="查到后取值得字段名字">查到后取值得字段名字</h1>

<p>取值就简单些，直接把字段名作为属性就可以取值了。如： entry.blog.name
一对多的关系就必须在名字后加上<code>_set</code>， 如 <code>blog.entry_set.all()</code></p>

<h3 id="关于一对多或多对多的关系链-查找的时候一定要理解-spanning-multi-valued-relationships-这段的意思-被给自己留下查询的隐患">&gt;：关于一对多或多对多的关系链，查找的时候一定要理解“Spanning multi-valued relationships”这段的意思，被给自己留下查询的隐患。</h3>

<p>详见：Django文档Spanning multi-valued relationships段落
这里就不再做叙述了。
However, unlike the behavior when using filter(), this will not limit blogs based on entries that satisfy both conditions. In order to do that, i.e. to select all blogs that do not contain entries published with “Lennon” that were published in 2008, you need to make two queries:</p>

<pre><code class="language-python">Blog.objects.exclude(
    entry=Entry.objects.filter(
        headline__contains='Lennon',
        pub_date__year=2008,
    ),
)
</code></pre>

<h3 id="mysql的distinct使用">&gt; mysql的distinct使用</h3>

<p>因为每个数据库背后的实现逻辑不通，造成orm的<code>distinct</code>的使用方式也不同，碰到类似题主要还是查看Django文档，结合Google搜索。
使用样例：</p>

<pre><code class="language-python">Para.objects.values('type').distinct().order_by('type').values_list('type', flat=True)
或
Para.objects.values_list('type').distinct().order_by('type').values_list('type', flat=True)
</code></pre>

<p><code>values</code> 和 <code>values_list</code>都是<code>QuerySet</code>子类，使用方法类似，但末尾还要再用<code>values_list</code>取值一次。Django是这样实现的，你就要这样使用。
其实上面也可以自己写python代码实现如：</p>

<pre><code class="language-python">[(i, i) for i in sorted(set(Para.objects.values_list('type', flat=True)))]
</code></pre>

<p>但是这样会增加服务端的压力</p>

<h3 id="在model中写方法-而且还能链式使用">&gt; 在model中写方法，而且还能链式使用</h3>

<p>这里提到的功能很是好用。可以用来写把查到的数据写成字典或列表的方法， 进而把数据传到前端使用。
查看文档 <a href="https://django-model-utils.readthedocs.org/en/latest/managers.html">django-model-utils documentation</a></p>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/django/">django</a>
          
          <a href="/tags/orm/">orm</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/django/django-model-form/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">django model 与 form 相关知识点</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/computer/03-method-of-use-google-no-agent/">
            <span class="next-text nav-default">不翻墙使用google大神的方法</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  
      </div>  
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
        <a href="https://github.com/michelia" class="iconfont icon-github" title="github"></a>
  <a href="http://michelia.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2017
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Michelia</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.min.js?v=2.5.0"></script>

<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>




</body>
</html>
